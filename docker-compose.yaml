services:
  waha:
    container_name: waha
    image: localhost/waha-local:latest
    build:
      context: .
      dockerfile: Dockerfile

    # Map host 6000 â†’ container 3000 (WAHA always runs on 3000 internally)
    ports:
      - "6000:3000"

    environment:
      # API key for auth (send in header: X-Api-Key)
      WAHA_API_KEY: ${WAHA_API_KEY}

      # Base URL should match the external port (host)
      WAHA_BASE_URL: "http://localhost:6000"

      WAHA_DEBUG_MODE: "${WAHA_DEBUG_MODE:-false}"
      WAHA_DASHBOARD_USERNAME: "${WAHA_DASHBOARD_USERNAME:-admin}"
      WAHA_DASHBOARD_PASSWORD: "${WAHA_DASHBOARD_PASSWORD:-123456}"
      WHATSAPP_API_HOSTNAME: "${WHATSAPP_API_HOSTNAME:-0.0.0.0}"

    volumes:
      - ../waha/sessions:/app/.sessions
      - ../waha/media:/app/.media

    restart: unless-stopped

    healthcheck:
      # Inside the container WAHA listens on 3000
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
